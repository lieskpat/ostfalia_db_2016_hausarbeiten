# 2. CAP-TheoremDas Akronym CAP wird aus den Anfangsbuchstaben der drei englischen Begriffe Consistency (Konsistenz), Availability (Verfügbarkeit) und Partition Tolerance (Ausfalltoleranz). Die aus den CAP-Theorem gewonnenen Erkenntnisse spielen bei verteilten Datenbanksystemen eine zentrale Rolle. Des Weiteren stellen verteilte Datenbanksysteme eine Basistechnologie der meisten NoSQL-Systeme dar, weil sich im Web2.0-Zeitalter die Erkenntnis durchgesetzt hat, dass die zu verabeitenden Datenmengen und die zu bedienenden Anwenderzahlen nur noch auf Basis dynamisch skalierbarer(„scale-up“) Rechner-/Servernetze zu realisieren sind.   Im Jahr 2000 wurden die CAP-Erkenntnisse von Eric A. Brewer noch als Vermutung formuliert, bis sie im Jahr 2002 von Gilbert und Nancy Lynch als CAP-Theorem bewiesen werden konnten. Aufgrund des Namen seines Erfinders wird das CAP-Theorem auch des Öfteren als Brewers Theorem bezeichnet.Definition der Begriffe* Consistency bezieht sich auf die Konsistenz der gespeicherten Daten. Innerhalb verteilter Systeme mit replizierten Daten muss sichergestellt werden, dass nachdem eine Transaktion abgeschlossen wurde auch alle Replikate des manipulierten Datensatzes aktualisiert werden.    * Availability bezeichnet die Verfügbarkeit der gespeiocherten Daten im Sinne akzeptabler Antwortzeiten. Hierbei spielt besonders die Tatsache eine Rolle, dass die Frusttoleranz gegenüber Wartezeiten auf Anfrageergebnisse beim kaufwilligen Kunden deutlich niedriger als bei den eigenen Mitarbeitern, die ihr Arbeitstempo einfach dem der Anwendung anpassen, ist.  Dies wurde auch durch verschiedener Untersuchungen großer Internet-Handelskonzerne bestätigt, so führen langsame Seiten ganz schnell zu einen Anbieterwechsel des Kundens. Bei E-Commerce-Anwendungen ist die Antwortzeit als elementare und äußerst kritische Anforderung zu bewerten und insbesondere auch Lastspitzen einzukalkulieren.    * Partition Tolerance meint die Ausfalltoleranz der Rechnernetze/Servernetze. So ist ein stabiler Betrieb des Gesamtsystems von Nöten, egal ob ein Server geplant Ausfällt z.B. durch Wartungsarbeiten oder durch den Austausch eines Servers aus Altersgründen oder ob ungeplant Ausfällt z.B. durch einen technischen Defekt oder auf Grund von Softwarefehlern genauso sollte ein Server zum Netz hinzugefügt werden. Des Weiteren muss der Ausfall einer Kommunikationsverbindung verkraftbar sein, ohne dass die laufende Anwendung beeinträchtigt wird und ohne, dass der Anwender etwas vom Ausfall mitbekommt. Um diese Redundanz der Daten zu gewährleisten, werden diese repliziert auf verschiedenen Servern gespeichert.    (Trelle, 2017) (Wikipedia, CAP-Theorem, 2017)     **Definition des Theorems**   In verteilen Systemen sind die drei Anforderungen nach Konsistenz (Consistency), Verfügbarkeit (Availability), Ausfalltoleranz (Partition Tolerance) nicht vollständig vereinbar und nur maximal zwei von dreien sind erreichbar. Aus diesen Grund muss daher individuell entschieden werden, ob sie als eine Kombination aus Konsistenz und Verfügbarkeit (CA), Konsistenz und Ausfalltoleranz (CP) oder aus Verfügbarkeit und Ausfalltoleranz (AP) sind.   ![Abbildung 1: CAP Theorem (Trelle, 2017)](/Abbildungen/CAP_Theorem.png)    Beispiele für die einzelnen Kombinationen wären:       **AP - Domain Name System (DNS) oder Cloud Computing**    Unter einen Domain Name System (DNS) versteht man einen Internet-Dienst, welcher IP-Adressen symbolische Hostnamen wie amazon.de zuordnen und diese später für TCP/IP-Kommunikation wieder in IP-Adressen auflösen.    Das Domain Name System (DNS) gehört zur Kategorie AP (Verfügbarkeit und Ausfalltoleranz). Denn die Verfügbarkeit ist extrem hoch, genauso wie die Toleranz gegenüber eines einzelnen DNS-Server Ausfalls. Anders sieht es auf Seite der Konsitenz aus, diese ist nicht immer direkt gegeben. So kann es teilweise Tage dauern, bis ein geänderter DNS-Eintrag an die gesamte DNS-Hierarchie propagiert ist und damit von allen Clients gesehen wird.    Bei Cloud-Plattformen wird auf eine horizontale Skalierung, sprich eine Lastaufteilung auf viele knoten, gesetzt. Diese Knoten bestehen oft aus billiger nicht unbedingt ausfallsicherer Hardware. Folglich ist es für eine Cloud-Anwendung zwingend nötig Toleranz gegenüber einzelner Knoten aufzuweisen. Des Weiteren wird bei Cloud-Systemen eine hohe Verfügbarkeit gefordert. Somit fallen Cloud-Anwendungen überwiegend auch in die Kategorie AP. Beispiele für Web-Anwendungen, die nicht auf strenge Konsistenz angewiesen sind, wären Social-Media-Sites wie Twitter oder Facebook; wenn einzelne Nachrichten nicht bei allen Nutzern gleichzeitig eintreffen, ist dadurch die prinzipielle Funktion des Dienstes nicht beeinträchtigt.    Da in diesen Fällen eine strenge Konsistenz auf Grund des CAP-Theorems nicht mehr gewährlistet werden kann, jedoch eine völlig inkonsistente Datenhaltung auch nicht gewünscht ist, muss sich mit schwächeren Konsistenzbedingungen abgefunden werden. Als Gegenstück zum ACID-Prinzip der relationalen Datenbanken setzen viele NoSQL-Datenbanken auf das BASE-Prinzip: Basically Available, Soft State, Eventual consistency. Eventual consistency lässt sich sinngemäß gut mit „schlussendlicher Konsistenz“ übersetzen, das heißt: das System ist nach Ablauf einer gewissen (möglichst kurzen) Zeitspanne der Inkonsistenz wieder in einem konsistenten Zustand.   **CA - Realtionales Datenbank Management System**    Relationale Datemnamlsysteme wie DB2 oder Oracle streben vor allem Konsistenz an.   RDBMS (Relationales Datenbank Management Systeme) gehören im Normalfall der Kategorie CA an. Da sie vor allem Verfügbarkeit und Konsistenz aller Knoten anstreben. Da diese meistens mit hochverfügbaren Netzwerken und Servern betrieben werden, spielt der Umgang mit Partitionierungen und damit die Ausfallsicherheit P, eine eher untergeordnete Rolle.       **CP - Banking-Anwendungen**    Innerhalb der verteilten Systeme für Finanzanwendungen wie z.B. Geldautomation hat die Konsistenz der Daten oberste Priorität. Ein Beispiel wäre Beispielweise eine Abhebung am Geldautomaten, so muss auch bei Störungen im Datenverkehr sichergestellt werden, dass auf der Kontenseite zuverlässig der abgehobene Betrag abgebucht wird. Genauso muss am Automaten eingezahltes Geld auf dem Konto verbucht werden (Partitionstoleranz).   Gegenüber der Konsistenz und der Partitionstoleranz ist die Verfügbarkeit zweitrangig (CP). Denn bei Netzwerkstörungen soll ein Geldautomat oder ein anderer Service lieber nicht verfügbar, anstatt dass Transaktionen falsch abgewickelt werden.         **Nutzen des CAP Theorems**   Obwohl eine allzu strenge Auslegung des CAP Theorems an Grenzen stößt, beschreibt es doch einen wichtigen Sachverhalt, nämlich die Notwendigkeit zwischen diesen unterschiedlichen Anforderungen, insbesondere zwischen Consistance (Konsistenz) und Availability(Verfügbarkeit), abzuwägen, und einen für die jeweilige Anwendung idealen Kompromiss zu finden.   Dies kann bereits bei der Auswahl eines geeigneten DBMS seinen Niederschlag finden, ausserdem erlauben viele der verteilten Systeme es auch für einzelne Datenbank­operationen, unterschiedlichen Strategien der Konsistenzsicherung zu gebrauchen. So dass eine Applikation von Fall zu Fall einen anderen Bereich der CAP Restriktionen abdeckt.    (Wikipedia, CAP-Theorem, 2017)